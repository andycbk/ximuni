<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的手作選物 | My Collection</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <style>
        /* --- 1. 視覺設定 --- */
        :root {
            --bg-color: #f9f8f4;
            --sidebar-bg: #eae8e0;
            --text-main: #4a4a4a;
            --text-light: #888888;
            --accent-color: #8c9ea3;
            --card-bg: #ffffff;
            --danger-color: #d9534f;
            --font-main: "Helvetica Neue", Helvetica, "PingFang TC", "Microsoft JhengHei", sans-serif;
            --grid-min-width: 160px;
            --gap-size: 15px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Header --- */
        header {
            width: 100%;
            height: 180px;
            background-color: #fff;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid #e0e0e0;
        }

        .brand-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.9;
        }

        .brand-text {
            position: absolute;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 25px;
            font-size: 1.5rem;
            letter-spacing: 3px;
            color: #333;
            border: 1px solid #ccc;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* --- 佈局容器 --- */
        .container {
            display: flex;
            flex: 1;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            position: relative;
        }

        /* --- 左側選單 --- */
        aside {
            width: 220px;
            padding: 30px 15px;
            position: sticky;
            top: 0;
            height: 100vh;
            border-right: 1px dashed #ccc;
            flex-shrink: 0;
        }

        aside h3 {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 15px;
            letter-spacing: 1px;
        }

        .menu-list { list-style: none; }
        .menu-list li { margin-bottom: 8px; }
        .menu-list li button {
            background: none;
            border: none;
            font-size: 1rem;
            color: var(--text-main);
            cursor: pointer;
            text-align: left;
            width: 100%;
            padding: 8px 10px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }
        .menu-list li button:hover { background-color: rgba(0,0,0,0.05); }
        .menu-list li button.active {
            background-color: var(--accent-color);
            color: #fff;
        }

        /* --- 右側內容區 --- */
        main { flex: 1; padding: 20px; }
        .category-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            display: inline-block;
        }

        /* --- 網格展示 --- */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(var(--grid-min-width), 1fr));
            gap: var(--gap-size);
        }

        .item-card {
            background: var(--card-bg);
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.2s ease;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        .item-card:hover { transform: translateY(-3px); box-shadow: 0 5px 12px rgba(0,0,0,0.1); }

        .img-placeholder {
            width: 100%;
            aspect-ratio: 1/1;
            background-color: #eee;
            margin-bottom: 8px;
            overflow: hidden;
            border-radius: 2px;
        }
        .img-placeholder img { width: 100%; height: 100%; object-fit: cover; }
        .item-desc { font-size: 0.9rem; font-weight: 600; color: #333; margin-bottom: 2px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .item-sub { font-size: 0.75rem; color: #999; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        /* --- 後台管理樣式 --- */
        #admin-panel {
            display: none; /* 預設隱藏 */
            background: #fff;
            border: 2px solid var(--accent-color);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .admin-controls input, .admin-controls select {
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            width: 100%;
            border-radius: 4px;
        }
        .btn {
            padding: 8px 15px;
            background-color: var(--accent-color);
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 4px;
            margin-top: 10px;
            width: 100%; /* 手機上按鈕大一點 */
        }
        .btn:hover { opacity: 0.9; }
        
        /* 刪除按鈕 */
        .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 255, 255, 0.9);
            color: var(--danger-color);
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 10;
        }
        .delete-btn:hover { background: var(--danger-color); color: #fff; }

        /* Footer & 登入按鈕 */
        footer {
            margin-top: auto;
            padding: 30px 20px;
            text-align: center;
            font-size: 0.8rem;
            color: #ccc;
            border-top: 1px solid #eee;
            background-color: #fcfcfc;
        }
        
        /* 登入按鈕樣式優化 */
        #login-btn { 
            cursor: pointer; 
            margin-left: 10px;
            padding: 5px 15px;
            border: 1px solid #ccc;
            border-radius: 20px;
            background: #fff;
            color: #666;
            font-size: 0.8rem;
            transition: all 0.3s;
        }
        #login-btn:hover {
            background: #333;
            color: #fff;
            border-color: #333;
        }

        /* 手機版適配 */
        @media (max-width: 768px) {
            header { height: 140px; }
            .container { flex-direction: column; }
            aside {
                width: 100%; height: auto; position: sticky; top: 0; z-index: 100;
                background: rgba(249, 248, 244, 0.95); backdrop-filter: blur(5px);
                border-right: none; border-bottom: 1px solid #ddd; padding: 10px 15px;
                display: flex; overflow-x: auto; white-space: nowrap;
            }
            aside h3 { display: none; }
            .menu-list { display: flex; gap: 10px; }
            .menu-list li { margin: 0; }
            .menu-list li button {
                background: #fff; border: 1px solid #ddd; padding: 5px 12px;
                font-size: 0.9rem; border-radius: 20px;
            }
            .menu-list li button.active { background: var(--accent-color); border-color: var(--accent-color); color: #fff; }
            main { padding: 15px 10px; }
            .gallery-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
        }
    </style>
</head>
<body>

    <header>
        <div class="brand-image-container">
            <img src="https://images.unsplash.com/photo-1493962853295-0fd70327578a?auto=format&fit=crop&w=1200&q=80" alt="Brand Banner">
            <div class="brand-text">MY STUDIO</div>
        </div>
    </header>

    <div class="container">
        <aside>
            <h3>CATEGORIES</h3>
            <ul class="menu-list">
                <li><button class="active" onclick="filterCategory('all', this)">全部 All</button></li>
                <li><button onclick="filterCategory('card-holder', this)">證件卡套</button></li>
                <li><button onclick="filterCategory('brooch', this)">胸針</button></li>
                <li><button onclick="filterCategory('luggage-tag', this)">行李吊牌</button></li>
                <li><button onclick="filterCategory('wooden-clip', this)">木伸縮扣</button></li>
            </ul>
        </aside>

        <main>
            <div id="admin-panel">
                <h3>+ 新增作品</h3>
                <div class="admin-controls">
                    <input type="file" id="upload-file" accept="image/*">
                    <select id="upload-category">
                        <option value="card-holder">證件卡套</option>
                        <option value="brooch">胸針</option>
                        <option value="luggage-tag">行李吊牌</option>
                        <option value="wooden-clip">木伸縮扣</option>
                    </select>
                    <input type="text" id="upload-title" placeholder="作品名稱">
                    <input type="text" id="upload-desc" placeholder="簡短說明">
                    <button class="btn" onclick="uploadItem()">上傳發布</button>
                    <span id="upload-status" style="font-size: 0.8rem; margin-top: 10px; display:block; color: var(--accent-color);"></span>
                </div>
                <div style="margin-top:10px; text-align:right;">
                    <button onclick="logout()" style="background:#999; font-size:0.8rem; border:none; color:#fff; padding:5px 10px; border-radius:4px; cursor:pointer;">登出管理員</button>
                </div>
            </div>

            <h2 id="current-title" class="category-title">全部作品</h2>
            <div class="gallery-grid" id="gallery-container">
                <p style="padding: 20px; color:#999;">正在連線到資料庫...</p>
            </div>
        </main>
    </div>

    <footer>
        <p>&copy; 2025 My Studio. All Rights Reserved.</p>
        <br>
        <button id="login-btn" onclick="login()">管理員登入 (Google)</button>
    </footer>

    <script>
        // =========================================================
        // ★ 修改區 1：請將您的 Firebase 設定整段貼在下方大括號內
        // =========================================================
        const firebaseConfig = {
          
  apiKey: "AIzaSyBV-Gk4SnHKJY1pQrlwHHzBKw5mRXzulGI",
  authDomain: "andycbk3.firebaseapp.com",
  projectId: "andycbk3",
  storageBucket: "andycbk3-store",
  messagingSenderId: "726068897432",
  appId: "1:726068897432:web:0b3f76eebea405509092ed"
};
     

        // =========================================================
        // ★ 修改區 2：請填入您的 Gmail (只有這個 Email 能當管理員)
        // =========================================================
        const adminEmail = "andycbk@gmail.com"; 

        // ---------------- 以下程式碼請勿更動 ----------------

        // 初始化 Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        const storage = firebase.storage();
        const auth = firebase.auth();

        let allItems = [];
        let currentFilter = 'all';
        let isAdmin = false;

        // 1. Google 登入邏輯
        function login() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then((result) => {
                    console.log("Google 驗證完成");
                }).catch((error) => {
                    alert("登入失敗：" + error.message);
                });
        }

        function logout() {
            auth.signOut();
        }

        // 2. 監聽登入狀態 & 安全檢查
        auth.onAuthStateChanged(user => {
            const panel = document.getElementById('admin-panel');
            const loginBtn = document.getElementById('login-btn');
            
            if (user) {
                // 檢查是否為管理員 Email
                if (user.email === adminEmail) {
                    isAdmin = true;
                    panel.style.display = 'block';
                    loginBtn.innerText = '管理員已登入 (' + user.displayName + ')';
                    loginBtn.style.borderColor = "var(--accent-color)";
                    loginBtn.onclick = null; // 避免重複點擊
                } else {
                    alert("抱歉，此帳號沒有管理權限！(請確認 adminEmail 設定)");
                    auth.signOut();
                    isAdmin = false;
                }
            } else {
                isAdmin = false;
                panel.style.display = 'none';
                loginBtn.innerText = '管理員登入 (Google)';
                loginBtn.onclick = login;
            }
            // 重新渲染畫面以更新刪除鈕狀態
            renderItems(currentFilter);
        });

        // 3. 讀取資料庫
        db.collection('products').orderBy('timestamp', 'desc').onSnapshot((snapshot) => {
            allItems = [];
            snapshot.forEach(doc => {
                allItems.push({ id: doc.id, ...doc.data() });
            });
            renderItems(currentFilter);
        }, (error) => {
            console.error("資料庫讀取失敗", error);
            const container = document.getElementById('gallery-container');
            // 檢查是否為尚未設定 Config
            if(firebaseConfig.apiKey.includes("您的")) {
                container.innerHTML = 
                    `<div style="grid-column: 1/-1; text-align:center; padding: 40px; background: #fff; border: 1px dashed #ccc;">
                        <h3 style="color: #d9534f;">⚠️ 尚未設定資料庫</h3>
                        <p>請打開 index.html 檔案</p>
                        <p>找到 <b>const firebaseConfig</b> 區塊，貼上您的設定碼。</p>
                        <p>找到 <b>const adminEmail</b>，填寫您的 Gmail。</p>
                    </div>`;
            } else {
                container.innerHTML = `<p style="color:red;">資料庫連線錯誤，請檢查主機 (Console) 訊息。</p>`;
            }
        });

        // 4. 渲染畫面
        function renderItems(filter) {
            const container = document.getElementById('gallery-container');
            const title = document.getElementById('current-title');
            
            container.innerHTML = ''; 

            const filteredItems = filter === 'all' ? allItems : allItems.filter(item => item.category === filter);

            const titleMap = { 'all': '全部作品', 'card-holder': '證件卡套', 'brooch': '胸針', 'luggage-tag': '行李吊牌', 'wooden-clip': '木伸縮扣' };
            title.innerText = titleMap[filter] || '作品展示';

            if (filteredItems.length === 0) {
                if(!firebaseConfig.apiKey.includes("您的")) {
                     container.innerHTML = '<p style="color:#999; grid-column: 1/-1; text-align:center;">目前此分類尚無作品，請登入後新增。</p>';
                }
                return;
            }

            filteredItems.forEach(item => {
                const card = document.createElement('div');
                card.className = 'item-card';
                // 只有管理員才看得到刪除鈕
                const deleteBtnDisplay = isAdmin ? 'flex' : 'none';
                
                card.innerHTML = `
                    <button class="delete-btn" style="display: ${deleteBtnDisplay}" onclick="deleteItem('${item.id}', '${item.imgRef}')">×</button>
                    <div class="img-placeholder"><img src="${item.imgUrl}" alt="${item.title}"></div>
                    <div class="item-desc">${item.title}</div>
                    <div class="item-sub">${item.desc}</div>
                `;
                container.appendChild(card);
            });
        }

        // 5. 切換分類
        function filterCategory(category, btnElement) {
            currentFilter = category;
            document.querySelectorAll('.menu-list button').forEach(btn => btn.classList.remove('active'));
            btnElement.classList.add('active');
            renderItems(category);
            
            if(window.innerWidth <= 768) {
                btnElement.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }
        }

        // 6. 上傳功能
        function uploadItem() {
            const file = document.getElementById('upload-file').files[0];
            const category = document.getElementById('upload-category').value;
            const title = document.getElementById('upload-title').value;
            const desc = document.getElementById('upload-desc').value;
            const status = document.getElementById('upload-status');

            if (!file || !title) {
                alert('請選擇圖片並輸入名稱');
                return;
            }
            status.innerText = '圖片上傳中... (請稍候)';

            // 存圖片
            const storageRef = storage.ref('images/' + new Date().getTime() + '_' + file.name);
            storageRef.put(file).then(snapshot => {
                return snapshot.ref.getDownloadURL();
            }).then(downloadURL => {
                // 存資料
                return db.collection('products').add({
                    category: category,
                    title: title,
                    desc: desc,
                    imgUrl: downloadURL,
                    imgRef: storageRef.fullPath,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
            }).then(() => {
                status.innerText = '上傳成功！';
                document.getElementById('upload-file').value = '';
                document.getElementById('upload-title').value = '';
                document.getElementById('upload-desc').value = '';
                setTimeout(() => status.innerText = '', 3000);
            }).catch(error => {
                console.error(error);
                status.innerText = '錯誤：' + error.message;
            });
        }

        // 7. 刪除功能
        function deleteItem(docId, imgRefPath) {
            if(!confirm('確定要刪除這張作品嗎？')) return;

            db.collection('products').doc(docId).delete().then(() => {
                if(imgRefPath) {
                    return storage.ref(imgRefPath).delete();
                }
            }).catch(error => {
                console.error("刪除失敗", error);
            });
        }
    </script>
</body>
</html>
